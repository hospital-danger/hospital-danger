// Generated by CoffeeScript 1.6.1
(function() {
  var _base, _ref, _ref1;

  if ((_ref = this.console) == null) {
    this.console = {};
  }

  if ((_ref1 = (_base = this.console).log) == null) {
    _base.log = function() {};
  }

  $(function() {
    var $buffer_bar, $play_button, $time_bar, $time_left, $video, cue_times, current_time, duration, time_line, to_clock, to_s;
    $video = Popcorn('#the-video');
    $play_button = $('.button-play');
    $time_bar = $('.time-bar');
    $buffer_bar = $('.buffer_bar');
    $time_left = $('.time-left');
    duration = 0;
    current_time = 0;
    to_s = Popcorn.util.toSeconds;
    to_clock = function(seconds) {
      var min, s;
      min = Math.floor(seconds / 60);
      s = seconds % 60;
      min = min > 9 ? "" + min : "0" + min;
      s = s > 9 ? "" + s : "0" + s;
      return "" + min + ":" + s;
    };
    cue_times = {
      "#safety": 2,
      "#quality-of-care": 15,
      "#infection": 20,
      "#culpability": 40,
      "#lawsuit": 60,
      "#no-improvement": 70
    };
    $play_button.add('#the-video').on("click", function() {
      if ($play_button.hasClass("paused")) {
        $video.play();
      } else {
        $video.pause();
      }
      return $play_button.toggleClass("paused");
    });
    $('.progress').on("click", function(e) {
      var pos;
      pos = e.offsetX / $(this).width();
      return $video.currentTime(pos * duration);
    });
    $('.chapter').on("click", function(e) {
      var target;
      e.preventDefault();
      target = $(this).attr('href');
      $video.currentTime(cue_times[target]).pause();
      $play_button.addClass('paused');
      $('.current-node').removeClass('current-node');
      return $(target).addClass('current-node');
    });
    $.each(cue_times, function(target, value) {
      return $video.cue(value, function() {
        $('.current-node').removeClass('current-node');
        return $(target).addClass('current-node');
      });
    });
    return (time_line = function() {
      current_time = $video.currentTime();
      duration = $video.duration() || 0;
      $time_bar.css({
        left: "" + (current_time / duration * 100) + "%"
      });
      $time_left.text(to_clock(Math.floor(duration - current_time)));
      return setTimeout(time_line, 200);
    })();
  });

}).call(this);
