// Generated by CoffeeScript 1.6.1
(function(){var e,t,n,r,i;(r=this.console)==null&&(this.console={});(i=(n=this.console).log)==null&&(n.log=function(){});t=Popcorn.util.toSeconds;e=function(e){var t,n;t=Math.floor(e/60);n=e%60;t=t>9?""+t:"0"+t;n=n>9?""+n:"0"+n;return""+t+":"+n};$(function(){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;a=Popcorn("#the-video");i=$(".playpause");s=$(".time-bar");n=$(".buffer_bar");u=$(".time-left");o=$(".time-elapsed");v=0;d=0;f=0;p=[{type:"chapter",title:"",target:"#intro",time:"00:00",hide_title:!0,image:"#"},{type:"chapter",title:"A Safe Place?",target:"#chapter1",time:"00:20",image:"#"},{type:"element",target:"#people",time:"00:33"},{type:"element-next",target:"#people",time:"00:40"},{type:"element",target:"#causes-of-death",time:"00:42"},{type:"chapter_end",time:"00:48"},{type:"chapter",title:"No One Watching",target:"#chapter2",time:"00:52",image:"#"},{type:"element",target:"#show-map",time:"01:11"},{type:"chapter_end",time:"01:29"},{type:"chapter",title:"No Simple Surgery",target:"#chapter3",time:"01:33",image:"#"},{type:"element",target:"#bacteria",time:"01:43"},{type:"chapter_end",time:"02:08"},{type:"chapter",title:"Deny & Defend",target:"#chapter4",time:"02:10",image:"#"},{type:"element",target:"#slashed-circle",time:"02:22"},{type:"element",target:"#take-responsibility",time:"02:34"},{type:"chapter_end",time:"02:41"},{type:"chapter",title:"The Malpractice Myth",target:"#chapter5",time:"02:44",image:"#"},{type:"element",target:"#lawsuits",time:"02:52"},{type:"chapter_end",time:"03:06"},{type:"chapter",title:"Result: Patient Harm",target:"#chapter6",time:"03:10",image:"#"},{type:"element",target:"#dollar",time:"03:28"},{type:"chapter",title:"",target:"#outro",time:"03:58",hide_title:!0,image:"#"},{type:"element",target:"#now-what",time:"03:59"}];l=function(){var e,t,n;n=[];for(e=0,t=p.length;e<t;e++){h=p[e];h.type==="chapter"&&n.push(h)}return n}();c=function(){var e,t,n;n=[];for(e=0,t=p.length;e<t;e++){h=p[e];h.type==="citation"&&n.push(h)}return n}();for(b=0,w=l.length;b<w;b++){h=l[b];r=$("<li style='left: "+t(h.time)/240*100+"%;'><a href='"+h.target+"'><img src='"+h.image+"'><span>"+h.title+"</span></a></li>");$("ul",".chapter-list").append(r)}a.on("play",function(){i.removeClass("paused");return $("aside.current").removeClass("current")});a.on("pause",function(){return i.addClass("paused")});y=function(){return i.hasClass("paused")?a.play():a.pause()};i.add("#the-video").on("click",y);m=function(e){var n,r,i,s,o;for(r=i=0,s=p.length;i<s;r=++i){h=p[r];h.target===e&&(o=[r,t(h.time)],f=o[0],n=o[1])}n!=null&&a.currentTime(n).play();$(".current-chapter").removeClass("current-chapter");return $("[href='"+e+"']").addClass("current-chapter")};$("a",".chapter-list").on("click",function(e){e.preventDefault();return m($(this).attr("href"))});a.on("timeupdate",function(){d=a.currentTime();v=a.duration()||0;s.css({left:""+d/v*100+"%"});o.text(e(Math.floor(d)));return u.text(e(Math.floor(v-d)))});$.each(p,function(e,n){return a.cue(t(n.time),function(){var e,t;switch(n.type){case"citation":return $(".citations").html("<a href='"+n.target+"' target='_blank'>"+n.title+"</a>");case"chapter":$(".current").removeClass("current");$(".current-2").removeClass("current-2");n.hide_title||$(".chapter-title").show().text(n.title).delay(3e3).fadeOut(2e3);$(".current-chapter").removeClass("current-chapter");return $("[href='"+n.target+"']").addClass("current-chapter");case"element":$(n.target).addClass("current");return typeof g[e=n.callback]=="function"?g[e]():void 0;case"element-next":$(n.target).addClass("current-2");return typeof g[t=n.callback]=="function"?g[t]():void 0;case"chapter_end":return a.pause()}})});$(".element").on("click",function(e){var t;e.preventDefault();a.pause();t=$(this).attr("href");if(t)return $(t).addClass("current")});$(".close-aside").on("click",function(e){e.preventDefault();$(this).closest("aside").removeClass("current");return a.play()});$("header.intro, .introduction").on("click",function(){$("#noise").remove();$("header").removeClass("intro");$(".introduction").addClass("finished");setTimeout(function(){return a.play()},1e3);return setTimeout(function(){return $(".introduction").hide()},5e3)});g={};$(window).load(function(){var e,t,n,r,i,s,o;e=window.state_data;n=$("#us-map")[0].contentDocument;s=n.getElementsByClassName("state");o=[];for(r=0,i=s.length;r<i;r++){t=s[r];$(t).on("mouseenter",function(n){var r,i,s,o,u,a,f,l,c,h;h=e.states;for(l=0,c=h.length;l<c;l++){t=h[l];t.state_abbreviation===this.id&&(u=t)}o=function(){var t;t=[];for(r in u){f=u[r];f===2&&r!=="score"&&t.push("<li>"+e.state_information_flags[r][f]+"</li>")}return t}();s=function(){var t;t=[];for(r in u){f=u[r];f===1&&r!=="score"&&t.push("<li>"+e.state_information_flags[r][f]+"</li>")}return t}();i=n.offsetX;i>400&&(i+=50);a=n.offsetY;a>300&&(a-=200);$("#state-info").show().css({top:a,left:i}).find("#state-name").text(u.state_title);$("#state-positive").html(o.join(""));return $("#state-negative").html(s.join(""))});o.push($(t).on("mouseleave",function(){return $("#state-info").hide()}))}return o});(function(){var e,t,n,r;t=$("#judy-gaines");e=$("img",t);r=e.length;n=[0];$(".sections",t).find("div.section").map(function(e){return n.push($(this).height()+n[e])});return $(".sections",t).on("scroll",function(){var t,i,s,o,u;o=$(this).scrollTop();s=(u=function(){var e,r,s;s=[];for(i=e=0,r=n.length;e<r;i=++e){t=n[i];if((n[i-1]||0)<o&&o<t){s.push(i)}}return s}())!=null?u:r-1;return e.removeClass("current-image").eq(s-1).addClass("current-image")})})();(function(){var e,t,n,r,i,s,o,u;t=$("#deny-and-defend");e=$(".aside-content",t);n=$(".papers",t);r=$(".quotes",t);u=6850;s=0;o=Modernizr.prefixed("transform");$.fn.parallax=function(e){var t,n;t=$(this);return(n=function(){var r;window.requestAnimationFrame(n);r=Modernizr.csstransforms3d?"translate3d("+s*e+"px, 0, 0)":"translateX("+s*e+"px)";return t.css(o,r)})()};$("img",n).each(function(e){$(this).parallax(e*.1);return $(this).css({left:e*100})});$(".prev",t).hover(function(t){return e.scrollTo({top:0,left:0},7e3)},function(){return e.stop()});$(".next",t).hover(function(t){return e.scrollTo({top:0,left:u},7e3)},function(){return e.stop()});i=$("img",n).length;return e.on("scroll",function(){var n;s=e.scrollLeft();n=0;if(n===i){e.addClass("finished");return $(".hospital-envelope").addClass("visible").on("click",function(){return $(".hospital-response").addClass("visible").on("click",function(){$(".visible",t).removeClass("visible");$(".finished").removeClass("finished");return a.play()})})}return $("blockquote",r).removeClass("current-quote").eq(n).addClass("current-quote")})})();$("a",".decision-tree").on("click",function(e){var t;e.preventDefault();t=$(this).attr("href");return $(".decision-tree").scrollTo(t,1e3)});return $("#end-decision-tree").on("click",function(e){e.preventDefault();return a.play()})})}).call(this);